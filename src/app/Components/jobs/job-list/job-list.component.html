<div class="container py-4">

  <ng-container *ngIf="!isLoading">
    <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center mb-4 mb-lg-5">

      <div class="mb-3 mb-lg-0">
        <h2 class="fw-bold text-nowrap available-jobs-title">Available Job Openings</h2>
        <p class="text-muted mb-0 small">
          Showing {{ paginatedJobs.length }} of {{ jobs.length }} total jobs
        </p>
      </div>

      <div class="d-flex align-items-center gap-3 justify-content-end w-100 w-lg-auto">

        <div class="position-relative w-100 search-wrapper" style="max-width: 450px;">
          <input
            type="text"
            class="form-control form-control-sm rounded-pill ps-5 pe-4 border-2"
            placeholder="Search job titles, companies"
            [(ngModel)]="searchText"
            (input)="filterJobs()"
          >

          <i
            class="bi bi-search position-absolute top-50 start-0 translate-middle-y ms-2 fs-6 search-icon"
            style="color: var(--primary-color);"
          ></i>

          <button
            *ngIf="searchText"
            class="btn btn-link clear-search-btn position-absolute top-50 end-0 translate-middle-y me-3 p-0"
            (click)="clearSearch()"
            title="Clear Search"
          >
            <i class="bi bi-x-circle-fill fs-5 text-muted clear-icon"></i>
          </button>
        </div>

        <button 
          type="button" 
          class="btn btn-sm view-toggle-btn" 
          [class.active]="viewMode === 'card'" 
          (click)="setView('card')" 
          [attr.aria-pressed]="viewMode === 'card'" 
          title="Card View"
        >
          <i class="bi bi-layout-wtf"></i>
        </button>
        
        <button 
          type="button" 
          class="btn btn-sm view-toggle-btn" 
          [class.active]="viewMode === 'list'" 
          (click)="setView('list')" 
          [attr.aria-pressed]="viewMode === 'list'" 
          title="List View"
        >
          <i class="bi bi-view-list"></i>
        </button>


        <button
          class="btn border-0 p-0 d-flex align-items-center justify-content-center bookmark-btn-wrapper"
          style="background: transparent;"
          title="Toggle Bookmarked Jobs Filter"
          (click)="toggleBookmarkFilter()"
        >
          <i
            class="{{ showBookmarksOnly ? 'bi-bookmark-fill' : 'bi-bookmark' }}
                d-flex align-items-center justify-content-center rounded-circle bookmark-icon"
            style="
              font-size: 1.1rem; /* Reduced font size from fs-5 for spacing */
              width: 38px;
              height: 38px;
              transition: 0.3s ease;
            "

            [style.border]="showBookmarksOnly
                          ? '3px solid var(--primary-color)'
                          : '2px solid var(--primary-color)'"

            [style.color]="showBookmarksOnly
                          ? 'var(--primary-color)'
                          : 'var(--primary-color)'"
          ></i>
        </button>

      </div>

    </div>
  </ng-container>

  <div *ngIf="isLoading" class="loader-wrapper">
      <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading jobs...</span>
      </div>
  </div>

  <div *ngIf="!isLoading && filteredJobs.length === 0" class="text-center py-5">
    
    <i class="bi bi-search-heart-fill d-block mb-3" style="font-size: 3rem; color: var(--primary-color);"></i>
    
    <h3 class="fw-bold text-dark-emphasis mb-2">
      {{ showBookmarksOnly ? 'No Bookmarks Found' : 'No Jobs Found' }}
    </h3>
    
    <p class="text-secondary mb-0">
      <ng-container *ngIf="showBookmarksOnly">
        You haven't bookmarked any jobs yet. Browse the full list to save your favorites!
      </ng-container>
      <ng-container *ngIf="!showBookmarksOnly">
        Try adjusting your search query or clear the filter to see more available positions.
      </ng-container>
    </p>

    <a 
      *ngIf="searchText || showBookmarksOnly" 
      class="text-decoration-underline mt-3 d-block" 
      style="cursor: pointer; color: var(--primary-color);"
      (click)="clearSearch(); toggleBookmarkFilter(false)"
    >
      Clear Filters and Search
    </a>
  </div>


  <ng-template #jobDetails let-job>
    <div>
      <h5 class="card-title fw-bolder mb-1 text-body-emphasis job-title-clamp">{{ job.title }}</h5> 
      <p class="text-secondary small mb-2">{{ job.company_name }}</p> 
      <div class="d-flex flex-wrap gap-1">
        <span class="badge bg-light text-dark border rounded-pill px-2 py-1 small">{{ job.job_type }}</span>
      </div>
      <p class="text-secondary small mb-0 mt-2"><i class="bi bi-geo-alt-fill me-1"></i>{{ job.candidate_required_location }}</p>
    </div>
  </ng-template>

  <div *ngIf="!isLoading && filteredJobs.length > 0 && viewMode === 'card'" class="row g-4">
    <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4" *ngFor="let job of paginatedJobs">
      <div class="card h-100 shadow-sm border-0 rounded-4 job-card-item">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <ng-container *ngTemplateOutlet="jobDetails; context: {$implicit: job}"></ng-container>
            </div>
            <i class="{{ isBookmarked(job.id) ? 'bi-bookmark-fill' : 'bi-bookmark' }} fs-4 bookmark-icon-item" (click)="toggleBookmark(job.id)"></i>
          </div>

          <div class="mt-auto d-flex justify-content-end">
            <a [routerLink]="['/jobs', job.id]" class="btn fw-semibold rounded-pill apply-btn">Apply Now</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="!isLoading && filteredJobs.length > 0 && viewMode === 'list'" class="list-group">
    <div class="list-group-item job-list-item d-flex align-items-center" *ngFor="let job of paginatedJobs">
      <div class="flex-grow-1">
        <ng-container *ngTemplateOutlet="jobDetails; context: {$implicit: job}"></ng-container>
      </div>
      <div class="d-flex flex-column flex-md-row align-items-end align-items-md-center gap-3 ms-3 job-actions">
        <a [routerLink]="['/jobs', job.id]" class="btn btn-sm apply-btn">Apply Now</a>
        <i class="{{ isBookmarked(job.id) ? 'bi-bookmark-fill' : 'bi-bookmark' }} fs-4 bookmark-icon-item" (click)="toggleBookmark(job.id)"></i>
      </div>
    </div>
  </div>

  <nav *ngIf="!isLoading && filteredJobs.length > 0" class="d-flex justify-content-center mt-5">
    <ul class="pagination pagination-sm" style="gap: 8px;">

      <li class="page-item" [class.disabled]="page === 1">
        <button
          class="page-link"
          style="
            background: none;
            border: none;
            color: var(--primary-color);
            padding: 4px 6px;
            box-shadow: none;
          "
          (click)="prevPage()"
        >
          <i class="bi bi-chevron-left"></i>
        </button>
      </li>

      <li
        class="page-item"
        *ngFor="let p of totalPagesArray"
        [class.active]="p === page"
      >
        <button
          class="page-link"
          (click)="goToPage(p)"
          style="
            background: none;
            border: none;
            padding: 4px 6px;
            box-shadow: none;
            font-weight: 500;
            color: var(--primary-color);
          "
          [style.fontWeight]="p === page ? '700' : '500'"
          [style.textDecoration]="p === page ? 'underline' : 'none'"
        >
          {{ p }}
        </button>
      </li>

      <li class="page-item" [class.disabled]="page === totalPages">
        <button
          class="page-link"
          style="
            background: none;
            border: none;
            color: var(--primary-color);
            padding: 4px 6px;
            box-shadow: none;
          "
          (click)="nextPage()"
        >
          <i class="bi bi-chevron-right"></i>
        </button>
      </li>

    </ul>
  </nav>

</div>