<app-auth-layout>
  <div class="auth-stack">
    <div class="welcome-header text-center mb-2">
      <div class="welcome-title">Welcome to <span>Job Portal</span></div>
    </div>

    <!-- BADGE -->
    <div class="text-center mb-3">
      <span
        class="badge rounded-pill px-3 py-2 fw-medium small"
        style="background: #ede7f6; color: var(--primary-color)"
      >
        ðŸš€ Trusted by thousands of developers
      </span>
    </div>
    <div class="auth-form-wrapper border-3 primary-color p-4 p-md-5">
      <h2 class="title text-center">Sign In to Proceed</h2>
      <p class="subtitle text-center">Explore new opportunities!</p>

      <form #loginForm="ngForm" (ngSubmit)="login()">
        <div class="input-icon">
          <i class="bi bi-person-fill icon-left"></i>
          <input
            type="text"
            class="form-control"
            placeholder="Email/Username"
            [(ngModel)]="username"
            name="username"
            (input)="onInput()"
            #usernameRef="ngModel"
            required
          />
        </div>
        @if(usernameRef.invalid && usernameRef.touched){
        <div class="form-error">
          <i class="bi bi-exclamation-triangle-fill"></i>Email or Username is
          required.
        </div>
        }
        <div class="input-icon">
          <i class="bi bi-lock-fill icon-left"></i>
          <input
            [type]="passwordVisible ? 'text' : 'password'"
            class="form-control"
            placeholder="Password"
            [(ngModel)]="password"
            (input)="onInput()"
            name="password"
            #passwordRef="ngModel"
            required
            minlength="8"
          />
          <button
            type="button"
            class="password-toggle"
            (click)="passwordVisible = !passwordVisible"
          >
            <i
              class="bi"
              [ngClass]="passwordVisible ? 'bi-eye-slash' : 'bi-eye'"
            ></i>
          </button>
        </div>
        @if(passwordRef.errors?.['required'] && passwordRef.touched){
        <div class="form-error">
          <i class="bi bi-exclamation-triangle-fill"></i>Password is required.
        </div>
        } @if(passwordRef.errors?.['minlength'] && passwordRef.touched){
        <div class="form-error">
          <i class="bi bi-exclamation-triangle-fill"></i>
          Password must be at least 8 characters long.
        </div>
        } @if(passwordRef.errors?.['pattern'] && passwordRef.touched){
        <div class="form-error">
          <i class="bi bi-exclamation-triangle-fill"></i>
          Password must contain at least one uppercase letter, one lowercase
          letter, one number, and one special character.
        </div>
        }
        <div class="mb-3 text-center captcha-wrapper">
          <ngx-recaptcha2
            #captchaElem
            [siteKey]="sitekey"
            [hidden]="!loginForm.valid"
            (success)="handleCaptcha($event)"
            (error)="captchaValid = false"
          >
          </ngx-recaptcha2>
        </div>

        <div class="d-flex justify-content-between mb-3">
          <label>
            <input type="checkbox" [(ngModel)]="rememberMe" name="rememberMe" />
            Remember me
          </label>

          <a class="forgot-link" href="#">Forgot Password?</a>
        </div>
        @if(errorMessage){
        <div class="alert alert-danger mt-2">
          {{ errorMessage }}
        </div>
        }

        <button
          type="submit"
          class="btn login-btn w-100"
          [disabled]="loading || !captchaValid"
        >
          @if(!loading){
          <span>Sign In</span>} @if(loading){
          <span class="spinner-border spinner-border-sm"></span>
          }
        </button>
      </form>

      <p class="auth-footer text-center mt-3">
        Don't have an account?
        <a routerLink="/register" class="signup-link">Sign Up</a>
      </p>
    </div>
  </div>
</app-auth-layout>
