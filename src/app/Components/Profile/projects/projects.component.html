<!-- VIEW MODE -->
<div *ngIf="!editMode" class="view">
  <div *ngFor="let p of user?.projects || []" class="mb-3">
    <h6 class="mb-0">{{ p.title }}</h6>
    <p class="small text-muted mb-1">{{ p.tech }}</p>
    <p class="mb-1">{{ p.description }}</p>
    <a *ngIf="p.url" [href]="p.url" target="_blank">{{ p.url }}</a>
  </div>
</div>

<!-- EDIT MODE -->
<form *ngIf="editMode" [formGroup]="form" (ngSubmit)="save()" class="edit">
  <div formArrayName="projects">
    <div
      *ngFor="let fg of projects.controls; let i = index"
      [formGroupName]="i"
      class="card p-2 mb-2"
    >
      <!-- Title -->
      <input
        class="form-control mb-1"
        placeholder="Project title"
        formControlName="title"
      />
      <div
        class="text-danger small"
        *ngIf="fg.get('title')?.touched && fg.get('title')?.errors"
      >
        Title is required (min 3 chars).
      </div>

      <!-- Tech -->
      <input
        class="form-control mb-1"
        placeholder="Technologies"
        formControlName="tech"
      />
      <div
        class="text-danger small"
        *ngIf="fg.get('tech')?.touched && fg.get('tech')?.errors"
      >
        Enter tech stack (min 2 chars).
      </div>

      <!-- URL -->
      <input
        class="form-control mb-1"
        placeholder="URL"
        formControlName="url"
      />
      <div
        class="text-danger small"
        *ngIf="fg.get('url')?.touched && fg.get('url')?.errors"
      >
        Enter a valid URL (optional).
      </div>

      <!-- Description -->
      <textarea
        class="form-control mb-1"
        formControlName="description"
        placeholder="Description"
      ></textarea>
      <div
        class="text-danger small"
        *ngIf="fg.get('description')?.touched && fg.get('description')?.errors"
      >
        Description is required (min 10 chars).
      </div>

      <!-- Remove -->
      <div class="text-end">
        <button type="button" class="btn btn-sm btn-danger" (click)="remove(i)">
          Remove
        </button>
      </div>
    </div>
  </div>

  <div class="d-flex justify-content-between">
    <button type="button" class="btn btn-sm btn-secondary" (click)="add()">
      + Add
    </button>

    <button type="submit" class="btn btn-success btn-sm">Save</button>
  </div>
</form>
