<app-auth-layout>
  <div class="w-100" style="max-width: 420px">
    <h2 class="fw-bold mb-2">Login</h2>
    <form #loginForm="ngForm" (ngSubmit)="login()">
      <input
        type="text"
        class="form-control mb-3"
        placeholder="Email/Username"
        [(ngModel)]="username"
        name="username"
        (input)="onInput()"
        #usernameRef="ngModel"
        required
      />
      @if(usernameRef.invalid && usernameRef.touched){
      <div class="text-danger mb-2">Email or Username is required.</div>
      }
      <div class="input-group mb-3">
      <input
        [type]="passwordVisible ? 'text' : 'password'"
        class="form-control"
        placeholder="Password"
        [(ngModel)]="password"
        (input)="onInput()"
        name="password"
        #passwordRef="ngModel"
        required
        minlength="8"
        pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[!@#$%^&*]).{8,}$"
      />
      <button
    type="button"
    class="btn btn-outline-secondary"
    (click)="passwordVisible = !passwordVisible"
  >
    <i class="bi" [ngClass]="passwordVisible ? 'bi-eye-slash' : 'bi-eye'"></i>
  </button>
  </div>
      @if(passwordRef.errors?.['required'] && passwordRef.touched){
      <div class="text-danger mb-2">Password is required.</div>
      } @if(passwordRef.errors?.['minlength'] && passwordRef.touched){
      <div class="text-danger mb-2">
        Password must be at least 8 characters long.
      </div>
      } @if(passwordRef.errors?.['pattern'] && passwordRef.touched){
      <div class="text-danger mb-2">
        Password must contain at least one uppercase letter, one lowercase
        letter, one number, and one special character.
      </div>
      }

      <div class="mb-3 text-center">
        <ngx-recaptcha2
          #captchaElem
          [siteKey]="sitekey"
          (success)="handleCaptcha($event)"
          (error)="captchaValid = false"
        >
        </ngx-recaptcha2>
      </div>

      <div class="d-flex justify-content-between mb-3">
        <label>
          <input type="checkbox" [(ngModel)]="rememberMe" name="rememberMe" />
          Remember me
        </label>

        <a class="forgot-link" href="#">Forgot Password?</a>
      </div>
      @if(errorMessage){
      <div class="alert alert-danger mt-2">
        {{ errorMessage }}
      </div>
      }

      <button
        type="submit"
        class="btn login-btn w-100"
        [disabled]="loading || !captchaValid "
      >
        @if(!loading){
        <span>Sign In</span>} @if(loading){
        <span class="spinner-border spinner-border-sm"></span>
        }
      </button>
    </form>

    <p class="text-center mt-3">
      Don't have an account?
      <a routerLink="/register" class="signup-link">Sign Up</a>
    </p>
  </div>
</app-auth-layout>
